const version="V1.1.4";$(function(){window.localStorage?util.init():($(".ok").fadeOut(300,"linear"),$("#ng").fadeIn(300,"linear"))});class confStore{constructor(){this.Umami={},this.player={platform:"netease",id:"8611769328"}}}class valStore{constructor(){this.Timer={hour:0,minutes:0,seconds:0,rhour:0,rminutes:0,rseconds:0,running:!1,sumhour:0,summinutes:0,sumseconds:0},this.tipsTimers={rolltimeout:0,hitokotoin:0,hitokotoout:0,worldtimein:0,worldtimeout:0,studytimein:0,studytimeout:0,attentionout:0}}}const conf=new confStore,val=new valStore;var tipstyp=attentionout=tipsrollnow=lauched=0;const util={init:function(){$(window).resize(util.videoresize),$("#bt_fs").fadeIn(300,"linear"),$("#scene_top").fadeIn(300,"linear"),$(".aplayer-icon-lrc").trigger("click"),util.initTips("hitokoto"),util.initTips("studytime"),util.initTips("worldtime"),util.musicset.init(),util.scene.init(),util.initClickEvent(),util.initStrictMode(),util.initWorldTimer(),util.readstoragetime(),util.initUmami(),util.initParams()},initParams:function(){function e(){util.study()}util.getUrlParams("type")&&ufunction.track(util.getUrlParams("type")),"study"==util.getUrlParams("mode")?(lauched=1,e(),ufunction.track("Study")):"strict"==util.getUrlParams("mode")&&(lauched=2,util.addVisibilityListener(),e(),ufunction.track("Study"))},initClickEvent:function(){$("#bt_fs").on("click",function(){util.fullscreen()}),$("#btt_strict").on("click",function(){util.switchStrictMode()}),$("#btt_start").on("click",function(){util.checkStrictMode()&&util.addVisibilityListener(),util.study()}),$("#btt_setting").on("click",function(){util.menuopen("menu")}),$("#btt_menu_music").on("click",function(){util.musicset.conf_page()}),$("#btt_about").on("click",function(){util.menuopen("about"),util.getUmami.GetAll()}),$("#bt_rest").on("click",function(){util.timerecord.pause(),util.menuopen("rest"),util.getUmami.OnlineUser(),$(".aplayer-pause").trigger("click")}),$("#bt_restclose").on("click",function(){$(".aplayer-play").trigger("click"),util.timerecord.start()}),$("#bt_musicswitch").on("click",function(){$(".aplayer-button").trigger("click")}),$("#about_cover").on("click",function(){$("#about").fadeOut(300,"linear"),$("#about_cover").fadeOut(300,"linear"),$("#scene_top").fadeIn(300,"linear")}),$("#menu_cover").on("click",function(){$("#menu").fadeOut(300,"linear"),$("#menu_cover").fadeOut(300,"linear"),$("#scene_top").fadeIn(300,"linear")}),$("#btt_scene").on("click",function(){util.scene.swap()})},menuopen:function(e){$("#"+e).fadeIn(300,"linear"),$("#"+e+"_cover").fadeIn(300,"linear"),$("#bt_"+e+"close").on("click",function(){$("#"+e).fadeOut(300,"linear"),$("#"+e+"_cover").fadeOut(300,"linear")})},getUrlParams:function(e){var t=window.location.search.substr(1);if(""==t)return!1;for(var i=t.split("&"),n=0;n<i.length;n++){var o=i[n].split("=");if(o[0]==e)return o[1]}return!1},readMusicconf:function(e,t="get",i=null){switch(t){case"set":return localStorage.setItem("conf_music_"+e,i);case"get":return localStorage.getItem("conf_music_"+e);default:console.log("Error: Unknown opration in editMusicconf()")}},musicset:{init:function(){null==util.readMusicconf("platform")||null==util.readMusicconf("id")?this.reset():(conf.player.platform=util.readMusicconf("platform"),conf.player.id=util.readMusicconf("id")),this.apply(),$("#btt_platform_netease").on("click",function(){conf.player.platform="netease",util.musicset.load()}),$("#btt_platform_tencent").on("click",function(){conf.player.platform="tencent",util.musicset.load()}),$("#btt_platform_kugou").on("click",function(){conf.player.platform="kugou",util.musicset.load()}),$("#btt_music_reset").on("click",function(){util.musicset.reset()}),$("#btt_music_submit").on("click",function(){util.musicset.apply()}),$("#songlist_id").on("input",function(){conf.player.id=$(this).val().replace(/[^\d]/g,""),util.musicset.load()})},load:function(){switch($("#musicconf").fadeOut(50,"linear"),conf.player.platform){case"netease":$("#musicconf #platform").text("网易云音乐");break;case"tencent":$("#musicconf #platform").text("QQ音乐");break;case"kugou":$("#musicconf #platform").text("酷狗音乐");break;default:this.reset()}$("#musicconf #id").text(conf.player.id),$("#songlist_id").attr("value",conf.player.id),$("#songlist_id").val(conf.player.id),conf.player.platform!==util.readMusicconf("platform")||conf.player.id!==util.readMusicconf("id")?$("#musicconf #conf_state").text("即将应用"):$("#musicconf #conf_state").text("已应用"),$("#musicconf").fadeIn(50,"linear")},loadPlayer:function(){$("meting-js").remove(),$("#bt_fs").after('<meting-js server="'+conf.player.platform+'" type="playlist" id='+conf.player.id+' fixed="true" theme="#39c5bb" order="random" mutex="true" lrc-type="0"> </meting-js>'),util.AplayerInteraction()},conf_page:function(){$("#music").fadeIn(300,"linear"),$("#top_cover").fadeIn(300,"linear"),$("#bt_musicclose").on("click",function(){$("#music").fadeOut(300,"linear"),$("#top_cover").fadeOut(300,"linear")})},reset:function(){conf.player.platform="netease",conf.player.id="8611769328",this.apply()},apply:function(){""==conf.player.platform||""==conf.player.id?this.reset():(util.readMusicconf("platform","set",conf.player.platform),util.readMusicconf("id","set",conf.player.id),this.load(),this.loadPlayer())}},AplayerInteraction:async function(){$(".aplayer").length?($(".aplayer-miniswitcher button").on("click",function(){$(".aplayer-list").addClass("aplayer-list-hide"),$(".aplayer").hasClass("aplayer-narrow")?$("#player_back").addClass("show"):$("#player_back").removeClass("show")}),$("#player_back").on("click",function(){$(".aplayer-list").hasClass("aplayer-list-hide")?$(".aplayer").hasClass("aplayer-narrow")||$(".aplayer-miniswitcher button").click():$(".aplayer-list").addClass("aplayer-list-hide")})):setTimeout(util.AplayerInteraction,500)},getUmami:{OnlineUser:async function(){$.get({url:conf.Umami.apiurl+"active",headers:conf.Umami.headers,success:function(e){conf.Umami.count_online.update(e.visitors),conf.Umami.count_online2.update(e.visitors)},error:function(){setTimeout(util.getUmami.OnlineUser,5e3)},timeout:function(){setTimeout(util.getUmami.OnlineUser,5e3)}})},GetEvents:async function(){let e=(new Date).getTime();$.get({url:conf.Umami.apiurl+"metrics?startAt=1691596800000&endAt="+e+"&type=event",headers:conf.Umami.headers,success:function(e){for(s=0;"Study"!=e[s].x&&null!=e[s+1];)s++;conf.Umami.count_studytimes.update(e[s].y)},error:function(){setTimeout(util.getUmami.GetEvents,5e3)},timeout:function(){setTimeout(util.getUmami.GetEvents,5e3)}})},GetVV:async function(){let e=(new Date).getTime();$.get({url:conf.Umami.apiurl+"stats?startAt=1691596800000&endAt="+e,headers:conf.Umami.headers,success:function(e){conf.Umami.count_visitor.update(e.visitors.value)},error:function(){setTimeout(util.getUmami.GetVV,5e3)},timeout:function(){setTimeout(util.getUmami.GetVV,5e3)}})},GetAll:async function(){this.OnlineUser(),this.GetEvents(),this.GetVV()}},initUmami:async function(){const e={useGrouping:!1};let t=new countUp.CountUp("umami_value_onlineuser",0,e),i=new countUp.CountUp("umami_value_onlineuser2",0,e),n=new countUp.CountUp("umami_value_studytimes",0,e),o=new countUp.CountUp("umami_value_visitors",0,e);const s="b91d816b-91e7-4974-ba3d-ccb61dbecfd6",a="https://umami.wenqi.icu/api/websites/"+s+"/",r={Authorization:"Bearer EJfpKblh2tLICYqBUDDs2eA/vd41CeoMtZpsZhrM5W6YkUyCJH/Dg64XEZp83nCVlIqgr8E2+oEeHL8HRSOf0lMsnHTdvsBsn/3rCSPXDI3kDmMBkG1m38JNIArp6Q1gaX6oZWDTph5H6KESaW4tKIhvwo7uaoFrU7OYDgZUG+YA8x41DZq+8HtAkdhJazAGIvyf2HYFRxZEHNb2tCkm2fwxDekKxnp91PYzZvpY0FoRtjKzq6znHmryoE4J42t8OFHv3g6oz/fFNN6RIXsPn9Nvlvr05qNlCNg5k3Iet+b3AkQPrxSpc2oTsvQPkpgctg1C/fYDs53+S8wMB+B4FtPmxn8vtQZnMw==","Access-Control-Allow-Origin":"*"};Object.defineProperties(conf.Umami,{count_online:{value:t},count_online2:{value:i},count_studytimes:{value:n},count_visitor:{value:o},apiurl:{value:a},headers:{value:r}}),this.getUmami.OnlineUser(),this.getUmami.GetEvents(),this.getUmami.GetVV()},study:function(){$(".aplayer-play").trigger("click"),$("#scene_top").fadeOut(300,"linear"),$("#scene_learning").fadeIn(300,"linear"),$("#bt_rest").fadeIn(300,"linear"),$("video").trigger("play"),this.videoresize(),setTimeout(()=>{this.videoresize()},500),this.Tips.init(),this.timerecord.start(),$("#bt_stop").on("click",function(){util.timerecord.stop(),util.Tips.stop(),$(".aplayer-pause").trigger("click"),$("#scene_top").fadeIn(300,"linear"),$("#scene_learning").fadeOut(300,"linear"),$("#bt_rest").fadeOut(300,"linear"),$("#rest").fadeOut(300,"linear"),$("#rest_cover").fadeOut(300,"linear"),lauched=0})},timerecord:{reset:function(){val.Timer.hour=0,val.Timer.minutes=0,val.Timer.seconds=0,val.Timer.rhour=0,val.Timer.rminutes=0,val.Timer.rseconds=0},start:function(){clearInterval(time),clearInterval(resttime),val.Timer.running||(this.reset(),$("#time").text(val.Timer.seconds+"秒钟了"),$("#resttime").text(val.Timer.rseconds+"秒钟了"),val.Timer.running=!0),util.timer()},stop:function(){if(clearInterval(time),clearInterval(resttime),val.Timer.running){let e=h=0;for(val.Timer.sumseconds=val.Timer.sumseconds+val.Timer.seconds;val.Timer.sumseconds>=60;)e++,val.Timer.sumseconds=val.Timer.sumseconds-60;for(val.Timer.summinutes=val.Timer.summinutes+val.Timer.minutes+e;val.Timer.summinutes>=60;)h++,val.Timer.summinutes=val.Timer.summinutes-60;val.Timer.sumhour=val.Timer.sumhour+val.Timer.hour+h,val.Timer.running=!1,util.writestoragetime()}},pause:function(){clearInterval(time),clearInterval(resttime),util.resttimer()}},initWorldTimer:function(){wtime=setInterval(function(){var e=new Date,t=m=h=0;h=e.getHours(),m=e.getMinutes(),t=e.getSeconds(),e.getHours()<10&&(h="0"+e.getHours()),e.getMinutes()<10&&(m="0"+e.getMinutes()),e.getSeconds()<10&&(t="0"+e.getSeconds()),$("#worldtime").text(h+"时"+m+"分"+t+"秒"),2==$("video")[0].readyState&&$("video").trigger("load"),$("video")[0].paused&&$("video").trigger("play")},1e3)},timer:function(){var e=sDate=pastmDate=mDate=pasthDate=hDate=0;time=setInterval(function(){var t=$("#time"),i=$("#studytime"),n=new Date;sDate=n.getSeconds(),mDate=n.getMinutes(),hDate=n.getHours(),(sDate-e>=1||mDate-pastmDate>=1||hDate-pasthDate>=1)&&val.Timer.seconds++,60==val.Timer.seconds&&(val.Timer.minutes++,val.Timer.seconds=0),60==val.Timer.minutes&&(val.Timer.hour++,val.Timer.minutes=0),"0"==val.Timer.minutes&&"0"==val.Timer.hour?t.text(val.Timer.seconds+"秒钟啦！继续加油吧！"):"0"!=val.Timer.hour?t.text(val.Timer.hour+"小时"+val.Timer.minutes+"分钟"+val.Timer.seconds+"秒啦！好厉害！！！"):val.Timer.minutes<=5?t.text(val.Timer.minutes+"分钟"+val.Timer.seconds+"秒啦！继续加油吧！"):t.text(val.Timer.minutes+"分钟"+val.Timer.seconds+"秒啦！超棒！"),"0"==val.Timer.minutes&&"0"==val.Timer.hour?i.text(val.Timer.seconds+"秒钟"):"0"!=val.Timer.hour?i.text(val.Timer.hour+"小时"+val.Timer.minutes+"分钟"+val.Timer.seconds+"秒"):i.text(val.Timer.minutes+"分钟"+val.Timer.seconds+"秒"),e=sDate,pastmDate=mDate,pasthDate=hDate},1e3)},resttimer:function(){var e=sDate=pastmDate=mDate=pasthDate=hDate=0;resttime=setInterval(function(){var t=$("#resttime"),i=new Date;sDate=i.getSeconds(),mDate=i.getMinutes(),hDate=i.getHours(),(sDate-e>=1||mDate-pastmDate>=1||hDate-pasthDate>=1)&&val.Timer.rseconds++,60==val.Timer.rseconds&&(val.Timer.rminutes++,val.Timer.rseconds=0),60==val.Timer.rminutes&&(val.Timer.rhour++,val.Timer.rminutes=0),"0"==val.Timer.rminutes&&"0"==val.Timer.rhour?t.text(val.Timer.rseconds+"秒钟"):"0"!=val.Timer.rhour?t.text(val.Timer.rhour+"小时"+val.Timer.rminutes+"分钟"+val.Timer.rseconds+"秒"):t.text(val.Timer.rminutes+"分钟"+val.Timer.rseconds+"秒"),e=sDate,pastmDate=mDate,pasthDate=hDate},1e3)},readstoragetime:function(){"GetDAZE"==localStorage.getItem("study")&&(val.Timer.sumhour=parseInt("0x"+localStorage.getItem("studyh")),val.Timer.summinutes=parseInt("0x"+localStorage.getItem("studym")),val.Timer.sumseconds=parseInt("0x"+localStorage.getItem("studys")),"0"==val.Timer.summinutes&&"0"==val.Timer.sumhour?$("#sumtime").text(val.Timer.sumseconds+"秒钟了"):"0"!=val.Timer.sumhour?$("#sumtime").text(val.Timer.sumhour+"小时"+val.Timer.summinutes+"分钟"+val.Timer.sumseconds+"秒了"):$("#sumtime").text(val.Timer.summinutes+"分钟"+val.Timer.sumseconds+"秒了"))},writestoragetime:function(){localStorage.setItem("study","GetDAZE"),localStorage.setItem("studyh",val.Timer.sumhour.toString(16)),localStorage.setItem("studym",val.Timer.summinutes.toString(16)),localStorage.setItem("studys",val.Timer.sumseconds.toString(16)),util.readstoragetime()},addVisibilityListener:function(){document.addEventListener("visibilitychange",function(){val.Timer.running&&(util.checkStrictMode()&&!lauched||2==lauched)&&("hidden"===document.visibilityState&&($("#bt_rest").trigger("click"),document.title="摸鱼中..."),"visible"===document.visibilityState&&(document.title="STUDY WITH MIKU"))})},checkStrictMode:function(){let e=localStorage.getItem("conf_strict")-"0";return e},initStrictMode:function(){null==util.checkStrictMode()?localStorage.setItem("conf_strict",0):util.checkStrictMode()&&($("#btt_strict")[0].innerText="严格模式(离开页面自动停止): 开")},switchStrictMode:function(){util.checkStrictMode()?($("#btt_strict")[0].innerText="严格模式(离开页面自动停止): 关",localStorage.setItem("conf_strict",0)):($("#btt_strict")[0].innerText="严格模式(离开页面自动停止): 开",localStorage.setItem("conf_strict",1))},initTips:function(e){switch(util.readTipsconf(e)){case 1:localStorage.setItem("conf_tips_"+e,1),$("#"+e+"_mode").text("轮换");break;case 2:localStorage.setItem("conf_tips_"+e,2),$("#"+e+"_mode").text("常驻");break;case 3:localStorage.setItem("conf_tips_"+e,3),$("#"+e+"_mode").text("隐藏");break;default:localStorage.setItem("conf_tips_"+e,1),$("#"+e+"_mode").text("轮换")}$("#btt_mode_"+e).on("click",function(){util.switchTipsconf(e)})},readTipsconf:function(e){let t=localStorage.getItem("conf_tips_"+e)-"0";return t},switchTipsconf:function(e){3==util.readTipsconf(e)?(localStorage.setItem("conf_tips_"+e,1),$("#"+e+"_mode").text("轮换")):1==util.readTipsconf(e)&&"hitokoto"!=e?(localStorage.setItem("conf_tips_"+e,2),$("#"+e+"_mode").text("常驻")):(localStorage.setItem("conf_tips_"+e,3),$("#"+e+"_mode").text("隐藏"))},Tips:{init:function(){$(".tips").html("").prepend('<p class="attention">开始认真学习/工作吧！</p>').append('<p class="hitokoto" style="display: none;">"<hitokoto id="hitokoto">获取一言中...(*/ω＼*)</hitokoto>"</p>'),2==util.readTipsconf("worldtime")?($(".attention").after('<p class="worldtime" style="display: none;">现在时间是:<text id="worldtime">0分钟</text></p>'),2==util.readTipsconf("studytime")?$(".worldtime").after('<p class="studytime" style="display: none;">已经学习<text id="studytime">0分钟</text>了</p>'):$(".tips").append('<p class="studytime" style="display: none;">已经学习<text id="studytime">0分钟</text>了</p>')):(2==util.readTipsconf("studytime")?$(".attention").after('<p class="studytime" style="display: none;">已经学习<text id="studytime">0分钟</text>了</p>'):$(".tips").append('<p class="studytime" style="display: none;">已经学习<text id="studytime">0分钟</text>了</p>'),$(".tips").append('<p class="worldtime" style="display: none;">现在时间是:<text id="worldtime">0分钟</text></p>')),util.Tips.start()},start:function(){val.tipsTimers.attentionout=setTimeout(function(){$(".attention").fadeOut(200,"linear"),1==util.readTipsconf("hitokoto")?tipsrollnow="hitokoto":1==util.readTipsconf("worldtime")?tipsrollnow="worldtime":1==util.readTipsconf("studytime")&&(tipsrollnow="studytime"),2==util.readTipsconf("worldtime")&&$(".worldtime").fadeIn(300,"linear"),2==util.readTipsconf("studytime")&&$(".studytime").fadeIn(300,"linear"),util.Tips.roll()},6e3)},roll:function(){if(1==util.readTipsconf(tipsrollnow)){if("hitokoto"==tipsrollnow){async function e(){const e=$("#hitokoto")[0];e.innerText="获取一言中...(*/ω＼*)";const t=await fetch("https://v1.hitokoto.cn/?c=i&c=k&max_length=10"),{hitokoto:i}=await t.json();e.innerText=i}1==util.readTipsconf("worldtime")?tipsrollnow="worldtime":1==util.readTipsconf("studytime")&&(tipsrollnow="studytime"),e(),val.tipsTimers.hitokotoin=setTimeout(function(){$(".hitokoto").fadeIn(300,"linear")},1300),val.tipsTimers.hitokotoout=setTimeout(function(){$(".hitokoto").fadeOut(300,"linear")},8600)}else"worldtime"==tipsrollnow?(1==util.readTipsconf("studytime")?tipsrollnow="studytime":1==util.readTipsconf("hitokoto")&&(tipsrollnow="hitokoto"),val.tipsTimers.worldtimein=setTimeout(function(){$(".worldtime").fadeIn(300,"linear")},1300),val.tipsTimers.worldtimeout=setTimeout(function(){$(".worldtime").fadeOut(300,"linear")},8600)):(1==util.readTipsconf("hitokoto")?tipsrollnow="hitokoto":1==util.readTipsconf("worldtime")&&(tipsrollnow="worldtime"),val.tipsTimers.studytimein=setTimeout(function(){$(".studytime").fadeIn(300,"linear")},1300),val.tipsTimers.studytimeout=setTimeout(function(){$(".studytime").fadeOut(300,"linear")},8600));val.tipsTimers.rolltimeout=setTimeout(function(){util.Tips.roll()},10900)}},stop:function(){Object.values(val.tipsTimers).forEach(e=>clearTimeout(e)),[$(".studytime"),$(".hitokoto"),$(".worldtime")].forEach(e=>e.fadeOut(300,"linear")),setTimeout(function(){$(".attention").fadeIn(300,"linear")},300)}},scene:{init:function(){switch(localStorage.getItem("conf_scene")){case"normal":$("#btt_scene")[0].innerText="经典",$("video").attr("src","assets/video/loop.mp4"),$("video").removeClass("video_sekai");break;case"sekai":$("#btt_scene")[0].innerText="SEKAI",$("video").attr("src","assets/video/loop_sekai.mp4"),$("video").removeClass("video_sekai");break;case"umi":$("#btt_scene")[0].innerText="UMI",$("video").attr("src","assets/video/loop_umi.mp4"),$("video").addClass("video_sekai");break;default:localStorage.setItem("conf_scene","normal"),$("#btt_scene")[0].innerText="经典",$("video").attr("src","assets/video/loop.mp4"),$("video").removeClass("video_sekai")}$("video").trigger("load"),$("video").trigger("play"),console.log("视频加载中..."),$("video").on("loadedmetadata",function(){util.videoresize(),$("#loading").fadeOut(300,"linear"),$("#btt_start").removeClass("disabled"),console.log("视频加载完成")})},swap:function(){const e=localStorage.getItem("conf_scene");switch($("#loading").fadeIn(300,"linear"),$("#btt_start").addClass("disabled"),e){case"normal":localStorage.setItem("conf_scene","sekai"),$("#btt_scene")[0].innerText="SEKAI",$("video").attr("src","assets/video/loop_sekai.mp4"),$("video").removeClass("video_sekai");break;case"sekai":localStorage.setItem("conf_scene","umi"),$("#btt_scene")[0].innerText="UMI",$("video").attr("src","assets/video/loop_umi.mp4"),$("video").addClass("video_sekai");break;case"umi":localStorage.setItem("conf_scene","normal"),$("#btt_scene")[0].innerText="经典",$("video").attr("src","assets/video/loop.mp4"),$("video").removeClass("video_sekai")}console.log("视频加载中..."),$("video").trigger("load"),$("video").trigger("play")}},videoresize:function(){var e=$(window).width(),t=$(window).height();$("video").width(),$("video").height();.5625*e>=t?$("video").css("height","auto").css("width",e).css("top",t/2-$("video").height()/2).css("left","0"):$("video").css("height",t).css("width","auto").css("left",e/2-$("video").width()/2).css("top","0")},fullscreen:function(e){util.checkFullscreen()?document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.exitFullscreen&&document.exitFullscreen():(e?"string"==typeof e&&(e=document.getElementById(e)):e=document.body,e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.requestFullscreen&&e.requestFullscreen()),util.checkFullscreen()?$("#bt_fs").text("∷全屏"):$("#bt_fs").text("∷退出全屏")},checkFullscreen:function(){return!!(document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenElement)}};console.log(`\n %c Study With Miku ${version} %c 在干什么呢(・∀・(・∀・(・∀・*) \n`,"color: #fadfa3; background: #030307; padding:5px 0;","background: #fadfa3; padding:5px 0; color: #000");